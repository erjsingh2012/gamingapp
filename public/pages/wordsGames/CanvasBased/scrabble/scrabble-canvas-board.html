<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Scrabble Canvas 11x11</title>
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      background: #f0f0f0;
    }

    .scale-wrapper {
      max-width: 430px;
      margin: auto;
      height: 100%;
      display: flex;
      flex-direction: column;
      background: white;
    }

    .debug-panel {
      height: 0;
      overflow: hidden;
    }

    .game-frame {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .panel {
      padding: 10px;
      border-bottom: 1px solid #ccc;
    }

    .top-panel-1 {
      background: #333;
      color: white;
      text-align: center;
    }

    .top-panel-2 {
      background: #f5f5f5;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .back-link {
      text-decoration: none;
      font-size: 18px;
    }

    .game-area {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #e9e9e9;
    }

    .board canvas {
      width: 100%;
      height: auto;
      touch-action: none;
    }

    .bottom-panel-1,
    .bottom-panel-2,
    .bottom-panel-3,
    .bottom-panel-4 {
      background: #f5f5f5;
    }

    #rack {
      display: flex;
      justify-content: center;
      padding: 10px;
      gap: 8px;
    }

    .tile {
      width: 40px;
      height: 40px;
      background: #f0e5d8;
      border: 2px solid #444;
      font-size: 24px;
      font-weight: bold;
      color: #222;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      cursor: grab;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="scale-wrapper" id="scale-wrapper">
    <div class="debug-panel" id="debug-panel"></div>
    <div class="game-frame">
      <div class="panel top-panel-1">WORDS with Friends 2</div>
      <div class="panel top-panel-2">
        <a class="back-link" href="../../../../index.html">⬅</a>
        <div class="panel">Player Info Panel</div>
      </div>
      <div class="game-area">
        <div class="board" id="board">
          <canvas id="boardCanvas" width="440" height="440"></canvas>
        </div>
      </div>
      <div class="panel bottom-panel-1">
        <span id="status">Practice played FRIT for 14 points</span>
      </div>
      <div class="panel bottom-panel-2" id="rack"></div>
      <div class="panel bottom-panel-3">More | Pass | PLAY | Swap | Shuffle</div>
      <div class="panel bottom-panel-4" id="bottom-panel-4"></div>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('boardCanvas');
    const ctx = canvas.getContext('2d');
    const status = document.getElementById('status');
    const rackPanel = document.getElementById('rack');

    const GRID_SIZE = 11;
    const CELL_SIZE = 40;
    const TILE_SIZE = 38;
    const RACK_TILES = 7;

    const bonusTiles = {
      '0,0': 'TW', '0,10': 'TW', '10,0': 'TW', '10,10': 'TW',
      '0,5': 'DL', '5,0': 'DL', '5,10': 'DL', '10,5': 'DL',
      '2,2': 'DW', '2,8': 'DW', '8,2': 'DW', '8,8': 'DW',
      '5,5': '★'
    };

    const TILE_BAG = 'eeeeeeeeeeeeaaaaaaaaaaiiiiiiiioooooooonnnnnrrrrrtttttllllssssuuuudgggbbccmmpffhhvvwwyykjxqz'.split('');

    let tilesOnBoard = {}; // { "row,col": {letter, id} }
    let draggingTile = null;
    let hoverCell = null;

    function drawRack() {
      rackPanel.innerHTML = '';
      for (let i = 0; i < RACK_TILES; i++) {
        const letter = TILE_BAG[Math.floor(Math.random() * TILE_BAG.length)];
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.textContent = letter.toUpperCase();
        tile.dataset.letter = letter;
        tile.draggable = true;
        tile.id = `tile-${Date.now()}-${i}`;

        tile.addEventListener('dragstart', (e) => {
          draggingTile = { letter, id: tile.id };
          e.dataTransfer.setData('text/plain', JSON.stringify(draggingTile));
        });

        rackPanel.appendChild(tile);
      }
    }

    function drawBoard() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let row = 0; row < GRID_SIZE; row++) {
        for (let col = 0; col < GRID_SIZE; col++) {
          const x = col * CELL_SIZE;
          const y = row * CELL_SIZE;
          const key = `${row},${col}`;

          ctx.fillStyle = bonusTiles[key] === 'TW' ? '#ffcccc' :
                          bonusTiles[key] === 'DW' ? '#ccffcc' :
                          bonusTiles[key] === 'DL' ? '#cce5ff' :
                          bonusTiles[key] === '★'  ? '#ffeb99' : '#fff';
          ctx.fillRect(x, y, CELL_SIZE, CELL_SIZE);

          ctx.strokeStyle = '#999';
          ctx.strokeRect(x, y, CELL_SIZE, CELL_SIZE);

          if (bonusTiles[key]) {
            ctx.fillStyle = '#000';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(bonusTiles[key], x + CELL_SIZE / 2, y + CELL_SIZE / 2);
          }

          const placed = tilesOnBoard[key];
          if (placed) {
            ctx.fillStyle = '#f0e5d8';
            ctx.fillRect(x + 2, y + 2, TILE_SIZE, TILE_SIZE);
            ctx.strokeStyle = '#222';
            ctx.strokeRect(x + 2, y + 2, TILE_SIZE, TILE_SIZE);
            ctx.fillStyle = '#000';
            ctx.font = '18px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(placed.letter.toUpperCase(), x + CELL_SIZE / 2, y + CELL_SIZE / 2);
          }

          if (hoverCell && hoverCell.row === row && hoverCell.col === col && !placed) {
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.strokeRect(x + 2, y + 2, CELL_SIZE - 4, CELL_SIZE - 4);
            ctx.lineWidth = 1;
          }
        }
      }
    }

    function getCellFromCoords(x, y) {
      const rect = canvas.getBoundingClientRect();
      const cx = x - rect.left;
      const cy = y - rect.top;
      const col = Math.floor(cx / CELL_SIZE);
      const row = Math.floor(cy / CELL_SIZE);
      if (col >= 0 && col < GRID_SIZE && row >= 0 && row < GRID_SIZE) {
        return { row, col };
      }
      return null;
    }

    canvas.addEventListener('mousemove', (e) => {
      const cell = getCellFromCoords(e.clientX, e.clientY);
      if (!cell || (hoverCell && cell.row === hoverCell.row && cell.col === hoverCell.col)) return;
      hoverCell = cell;
      drawBoard();
    });

    canvas.addEventListener('mouseleave', () => {
      hoverCell = null;
      drawBoard();
    });

    canvas.addEventListener('dragover', (e) => {
      e.preventDefault();
    });

    canvas.addEventListener('drop', (e) => {
      e.preventDefault();
      const cell = getCellFromCoords(e.clientX, e.clientY);
      if (!cell) return;

      const key = `${cell.row},${cell.col}`;
      if (tilesOnBoard[key]) return;

      try {
        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
        tilesOnBoard[key] = { letter: data.letter, id: data.id };
        const tileEl = document.getElementById(data.id);
        if (tileEl) tileEl.remove();

        status.textContent = `Placed ${data.letter.toUpperCase()} at (${cell.row}, ${cell.col})`;
        drawBoard();
      } catch {
        console.warn('Invalid tile drop.');
      }
    });

    drawBoard();
    drawRack();
  </script>
</body>
</html>
